# Internationalization and Localization

## Build flow

1. babel-plugin-react-intl will be triggered by babel build process,
walking through all files containing `<FormattedMessage>` components
or defineMessages helper functions to build intl files into the same folder structure in a specific folder.
2. The Gulp task `intl` will merge multiple language definition files into single file in `public/locale-data`.
3. `<IntlProvider>` will read the default language file from `public/locale-data` so that value can be read by each of the ids.
4. After all, a default.json file will be generated inside `public/locale-data`, and it will be ready for translation.
5. Export and name the rest of language file in i18n format, such as `en.json`, `zh-HK.json`, etc.

## Example Usage

#### Step 1
Use the higher order function as a Container in your React component directly:

It saves time and effort including both higher order functions
and transformation from react-validation-mixin and react-intl.

```javascript
import FormValidation from 'app/main/form-validation/containers/FormValidation';
export default FormValidation(ExampleComponent);
```

#### Step 2
Use JSON.parse to transform stringified i18n objects:

You may use a helper function called renderValidationMessages
to format the parsed messages from this.props.getValidationMessages.

```javascript
<span>{this.renderValidationMessages(getValidationMessages('username'))}</span>
```

The only things you need to add is the JSON.parse function to transform I18N string
into a valid object, which can be parsed by formatMessage by react-intl.

```javascript
renderValidationMessages(messages) {
  const {
    formatMessage,
  } = this.props.intl;

  return messages.map((message, index) => (
    <div key={index}>{formatMessage(JSON.parse(message))}</div>
  ));
}
```

## Use FormattedMessage for static usage

```html
<FormattedMessage
  id="company.createNewCompany"
  defaultMessage="Create new company"
/>
```

## Use defineMessages for dynamic usage

```javascript
import { defineMessages, injectIntl } from 'react-intl';

const MESSAGES = defineMessages({
  username: {
    id: 'username',
    defaultMessage: 'Username',
  },
});

function ExampleComponent({ intl }) {
  const { formatMessage } = intl;

  return (
    <div>
      {formatMessage(MESSAGES.username)}
    </div>
  );
}

export default injectIntl(ExampleComponent);
```

## Customize Validation Messages

We are using react-validation-mixin, which uses Joi for object validation.
Following the steps below would help translate validation message easily.

Define custom validation messages in react-intl way in 'app/main/form-validation/constants/i18nValidationMessages':

```javascript
import { defineMessages } from 'react-intl';
import transformJoiTemplateString from '../helpers/transformJoiTemplateString';
import stringifyI18nObject from '../helpers/stringifyI18nObject';

// only accepts single level of object input
const I18N_MESSAGES = defineMessages({
  'any.invalid': {
    id: 'joi.any.invalid',
    // {key} must be single quoted
    // {{key}} is wrong because it is not supported by react-intl
    defaultMessage: '{key} contains an invalid value',
  },
});

// transform template string format from react-intl to joi
// e.g. {key} to {{key}}
const i18nMessages = transformJoiTemplateString(I18N_MESSAGES);

// maintain the same object format for joi
export default stringifyI18nObject({
  language: {
    any: {
      invalid: i18nMessages['any.invalid'],
    },
  },
};
```
